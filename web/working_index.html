<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>–°—Ä–µ–¥–Ω–∞ –°–∫–æ—Ä–æ—Å—Ç - –°–æ—Ñ–∏—è-–ü–ª–æ–≤–¥–∏–≤ (A1/E80)</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
    <div id="map"></div>
    
    <div class="speed-display">
        <div class="speed-row">
            <div class="speed-item">
                <div class="speed-label">–¢–µ–∫—É—â–∞ —Å–∫–æ—Ä–æ—Å—Ç</div>
                <div class="speed-value" id="current-speed">0.0 –∫–º/—á</div>
            </div>
            <div class="speed-item">
                <div class="speed-label">–°—Ä–µ–¥–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç</div>
                <div class="speed-value" id="average-speed">0.0 –∫–º/—á</div>
            </div>
        </div>
        
        <div class="info-box">
            <div class="info-row">
                <span>–ü—Ä–æ–≥–Ω–æ–∑–Ω–∞ —Å—Ä–µ–¥–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç:</span>
                <span id="predicted-speed">0.0 –∫–º/—á</span>
            </div>
            <div class="info-row">
                <span>–ò–∑–º–∏–Ω–∞—Ç–æ —Ä–∞–∑—Å—Ç–æ—è–Ω–∏–µ:</span>
                <span id="distance">0.0 –∫–º</span>
            </div>
            <div class="info-row" id="direction-row" style="display: none;">
                <span>–ü–æ—Å–æ–∫–∞ –Ω–∞ –¥–≤–∏–∂–µ–Ω–∏–µ:</span>
                <span id="current-direction">--</span>
            </div>
        </div>
        
        <!-- Auto-guidance panel - always visible -->
        <div class="auto-guidance-box" id="auto-guidance-box">
            <div class="auto-guidance-header">
                <span class="auto-guidance-icon">ü§ñ</span>
                <span class="auto-guidance-label">–ü—Ä–µ–ø–æ—Ä—ä–∫–∞ –∑–∞ —Å–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –ª–∏–º–∏—Ç–∞</span>
            </div>
            <div class="auto-guidance-content">
                <div class="auto-guidance-target">
                    <span>–ö–∞—Ä–∞–π—Ç–µ –¥–æ: </span>
                    <span id="auto-target-speed" class="target-speed">--</span>
                    <span id="auto-target-reason" class="target-reason">–∑–∞ –¥–∞ –ø–æ—Å—Ç–∏–≥–Ω–µ—Ç–µ –∑–∞–∫–æ–Ω–Ω–∞ —Å—Ä–µ–¥–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç 140 –∫–º/—á</span>
                </div>
                <div class="auto-guidance-status" id="auto-guidance-status">
                    –ò–∑—á–∞–∫–≤–∞–Ω–µ –∑–∞ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ
                </div>
            </div>
        </div>
        
    </div>
    
    <div class="control-buttons">
        <button id="tracking-btn" onclick="toggleTracking()">
            <span id="btn-icon">‚ñ∂</span>
            <span id="btn-text">–ó–∞–ø–æ—á–Ω–∏</span>
        </button>
        <button id="force-zone-btn" onclick="forceZoneDetection()" style="display: none;">
            <span id="zone-btn-icon">üéØ</span>
            <span id="zone-btn-text">–ù–∞–º–µ—Ä–∏ –∑–æ–Ω–∞</span>
        </button>
        <button id="pause-btn" onclick="togglePause()" style="display: none;">
            <span id="pause-icon">‚è∏Ô∏è</span>
            <span id="pause-text">–ü–∞—É–∑–∞</span>
        </button>
        <button id="history-btn" onclick="showSessionHistory()" style="display: block;">
            <span>üìö</span>
            <span>–ò—Å—Ç–æ—Ä–∏—è</span>
        </button>
    </div>
    
    <!-- Session History Modal -->
    <div id="session-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ò—Å—Ç–æ—Ä–∏—è –Ω–∞ —Å–µ—Å–∏–∏—Ç–µ</h3>
                <button onclick="closeSessionModal()">‚úï</button>
            </div>
            <div id="session-list"></div>
        </div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Quick error check
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.error);
            alert('JavaScript Error: ' + e.message + ' (Check console for details)');
        });
        
        // Test if everything is loading
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ DOM loaded');
            
            if (typeof L === 'undefined') {
                console.error('‚ùå Leaflet not loaded');
                alert('‚ùå Map library failed to load. Check internet connection.');
                return;
            }
            console.log('‚úÖ Leaflet loaded');
            
            // Initialize map immediately for testing
            try {
                const map = L.map('map').setView([42.4, 25.5], 8);
                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(map);
                console.log('‚úÖ Map initialized successfully');
                
                // Add test marker
                L.marker([42.4, 25.5]).addTo(map)
                    .bindPopup('‚úÖ Map working! GPS tracking ready.')
                    .openPopup();
                    
            } catch (error) {
                console.error('‚ùå Map initialization failed:', error);
                alert('‚ùå Map failed to initialize: ' + error.message);
            }
        });
        
        // Simple test functions
        function toggleTracking() {
            alert('üìç Click "–ó–∞–ø–æ—á–Ω–∏" to start GPS tracking!');
        }
        
        function forceZoneDetection() { alert('Zone detection test'); }
        function togglePause() { alert('Pause test'); }
        function showSessionHistory() { alert('History test'); }
        function closeSessionModal() { }
        
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <!-- Google Analytics -->
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1HJJPVBRH3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-1HJJPVBRH3');
    </script>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Sredna Skorost BG">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Sredna Skorost BG">
    <meta name="theme-color" content="#1976D2">
    <meta name="msapplication-navbutton-color" content="#1976D2">
    <meta name="msapplication-TileColor" content="#1976D2">
    <meta name="msapplication-starturl" content="/">
    
    <!-- PWA Description -->
    <meta name="description" content="–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞ –∫–æ–Ω—Ç—Ä–æ–ª –Ω–∞ —Å—Ä–µ–¥–Ω–∞—Ç–∞ —Å–∫–æ—Ä–æ—Å—Ç –ø–æ –±—ä–ª–≥–∞—Ä—Å–∫–∏—Ç–µ –º–∞–≥–∏—Å—Ç—Ä–∞–ª–∏ A1/E80">
    <meta name="keywords" content="—Å–∫–æ—Ä–æ—Å—Ç, –º–∞–≥–∏—Å—Ç—Ä–∞–ª–∞, –ê1, –ï80, –ë—ä–ª–≥–∞—Ä–∏—è, speed, highway, monitoring">
    
    <title>Sredna Skorost BG</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicons and App Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="512x512" href="favicon-512x512.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icons/Icon-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="favicon-512x512.png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
    <div id="map"></div>
    

    <div class="speed-display">
        <div class="speed-row">
            <div class="speed-item">
                <div class="speed-label">–¢–µ–∫—É—â–∞ —Å–∫–æ—Ä–æ—Å—Ç</div>
                <div class="speed-value" id="current-speed">0.0 –∫–º/—á</div>
            </div>
            <div class="speed-item">
                <div class="speed-label">–°—Ä–µ–¥–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç</div>
                <div class="speed-value" id="average-speed">0.0 –∫–º/—á</div>
            </div>
        </div>
        
        <div class="info-box">
            <div class="info-row">
                <span>–ü—Ä–æ–≥–Ω–æ–∑–Ω–∞ —Å—Ä–µ–¥–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç:</span>
                <span id="predicted-speed">0.0 –∫–º/—á</span>
            </div>
            <div class="info-row">
                <span>–ò–∑–º–∏–Ω–∞—Ç–æ —Ä–∞–∑—Å—Ç–æ—è–Ω–∏–µ:</span>
                <span id="distance">0.0 –∫–º</span>
            </div>
            <div class="info-row" id="direction-row" style="display: none;">
                <span>–ü–æ—Å–æ–∫–∞ –Ω–∞ –¥–≤–∏–∂–µ–Ω–∏–µ:</span>
                <span id="current-direction">--</span>
            </div>
            <div class="info-row" style="font-size: 12px; color: #666; text-align: center;">
                <span>–ú–∞–≥–∏—Å—Ç—Ä–∞–ª–∞ A1/E80: –í–∞–∫–∞—Ä–µ–ª ‚Üí –¢—Ä–∏–ª–∏—Å—Ç–Ω–∏–∫</span>
            </div>
        </div>
        
        <!-- Auto-guidance panel - always visible -->
        <div class="auto-guidance-box" id="auto-guidance-box">
            <div class="auto-guidance-header">
                <span class="auto-guidance-icon">ü§ñ</span>
                <span class="auto-guidance-label">–ü—Ä–µ–ø–æ—Ä—ä–∫–∞ –∑–∞ —Å–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –ª–∏–º–∏—Ç–∞</span>
            </div>
            <div class="auto-guidance-content">
                <div class="auto-guidance-target">
                    <span>–ö–∞—Ä–∞–π—Ç–µ –¥–æ: </span>
                    <span id="auto-target-speed" class="target-speed">--</span>
                    <span id="auto-target-reason" class="target-reason">–∑–∞ –¥–∞ –ø–æ—Å—Ç–∏–≥–Ω–µ—Ç–µ –∑–∞–∫–æ–Ω–Ω–∞ —Å—Ä–µ–¥–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç 140 –∫–º/—á</span>
                </div>
                <div class="auto-guidance-status" id="auto-guidance-status">
                    –ò–∑—á–∞–∫–≤–∞–Ω–µ –∑–∞ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ
                </div>
            </div>
        </div>
        
    </div>
    
    
    <!-- Top Right Controls -->
    <div class="top-right-controls">
        <button id="history-btn" onclick="showSessionHistory()" title="–ò—Å—Ç–æ—Ä–∏—è –Ω–∞ —Å–µ—Å–∏–∏—Ç–µ">
            <span style="font-size: 14px;">üìö</span>
        </button>
        <button id="info-btn" onclick="showInfoModal()" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è">
            <span style="font-size: 14px;">‚ÑπÔ∏è</span>
        </button>
    </div>
    
    <!-- Bottom Control Bar -->
    <div class="control-buttons">
        <button id="tracking-btn" onclick="toggleTracking()">
            <span id="btn-icon">‚ñ∂</span>
            <span id="btn-text">–ó–∞–ø–æ—á–Ω–∏</span>
        </button>
        <button id="pause-btn" onclick="togglePause()" style="display: none;">
            <span id="pause-icon">‚è∏Ô∏è</span>
            <span id="pause-text">–ü–∞—É–∑–∞</span>
        </button>
    </div>
    
    <!-- Session History Modal -->
    <div id="session-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ò—Å—Ç–æ—Ä–∏—è –Ω–∞ —Å–µ—Å–∏–∏—Ç–µ</h3>
                <button onclick="closeSessionModal()">‚úï</button>
            </div>
            <div id="session-list"></div>
        </div>
    </div>
    
    
    <!-- Locate Me Button -->
    <button class="locate-me-btn" onclick="centerOnLocation()" title="–¶–µ–Ω—Ç—Ä–∏—Ä–∞–π –Ω–∞ –º–æ—è—Ç–∞ –ª–æ–∫–∞—Ü–∏—è">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 8C9.79 8 8 9.79 8 12C8 14.21 9.79 16 12 16C14.21 16 16 14.21 16 12C16 9.79 14.21 8 12 8ZM20.94 11C20.48 6.83 17.17 3.52 13 3.06V1H11V3.06C6.83 3.52 3.52 6.83 3.06 11H1V13H3.06C3.52 17.17 6.83 20.48 11 20.94V23H13V20.94C17.17 20.48 20.48 17.17 20.94 13H23V11H20.94ZM12 19C8.13 19 5 15.87 5 12C5 8.13 8.13 5 12 5C15.87 5 19 8.13 19 12C19 15.87 15.87 19 12 19Z" fill="#1976D2"/>
        </svg>
    </button>
    
    <!-- Bug Report Button -->
    <button class="bug-report-btn" onclick="toggleBugReport()" title="–î–æ–∫–ª–∞–¥–≤–∞–π –ø—Ä–æ–±–ª–µ–º">
        <span style="font-size: 20px;">üêõ</span>
    </button>
    
    <!-- Bug Report Modal -->
    <div id="bug-report-modal" style="display: none;">
        <div class="bug-report-content">
            <div class="bug-report-header">
                <h3>üêõ –î–æ–∫–ª–∞–¥–≤–∞–π –ø—Ä–æ–±–ª–µ–º</h3>
                <button onclick="closeBugReport()">‚úï</button>
            </div>
            <div class="bug-report-body">
                <textarea id="bug-description" placeholder="–û–ø–∏—à–µ—Ç–µ –ø—Ä–æ–±–ª–µ–º–∞ —Ç—É–∫..." rows="5"></textarea>
                <div class="bug-report-info">
                    <small>–í–∞—à–µ—Ç–æ —Å—ä–æ–±—â–µ–Ω–∏–µ —â–µ –±—ä–¥–µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–æ —á—Ä–µ–∑ WhatsApp</small>
                </div>
                <div class="bug-report-actions">
                    <button onclick="closeBugReport()" class="btn-cancel">–û—Ç–∫–∞–∑</button>
                    <button onclick="sendBugReport()" class="btn-send">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                            <path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/>
                        </svg>
                        –ò–∑–ø—Ä–∞—Ç–∏ —á—Ä–µ–∑ WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Info Modal -->
    <div id="info-modal" style="display: none;">
        <div class="info-modal-content">
            <div class="info-modal-header">
                <h3>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <button onclick="closeInfoModal()">‚úï</button>
            </div>
            <div class="info-modal-body">
                <div class="info-section">
                    <h4>–ó–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ</h4>
                    <p>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞ –∫–æ–Ω—Ç—Ä–æ–ª –Ω–∞ —Å—Ä–µ–¥–Ω–∞—Ç–∞ —Å–∫–æ—Ä–æ—Å—Ç –ø–æ –º–∞–≥–∏—Å—Ç—Ä–∞–ª–∞ A1/E80 –º–µ–∂–¥—É –í–∞–∫–∞—Ä–µ–ª –∏ –ò—Ö—Ç–∏–º–∞–Ω.</p>
                </div>
                <div class="info-section">
                    <h4>–ö–∞–∫ —Ä–∞–±–æ—Ç–∏</h4>
                    <p>‚Ä¢ –ù–∞—Ç–∏—Å–Ω–µ—Ç–µ "–ó–∞–ø–æ—á–Ω–∏" –∑–∞ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ—Ç–æ<br>
                    ‚Ä¢ GPS –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞—Å–∏—á–∞ –≤–ª–∏–∑–∞–Ω–µ—Ç–æ –≤ –∑–æ–Ω–∞—Ç–∞<br>
                    ‚Ä¢ –°–ª–µ–¥–µ—Ç–µ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏—Ç–µ –∑–∞ —Å–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –ª–∏–º–∏—Ç–∞<br>
                    ‚Ä¢ –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ "–ü–∞—É–∑–∞" –ø—Ä–∏ –Ω—É–∂–¥–∞</p>
                </div>
                <div class="info-section">
                    <h4>GPS —Ç–æ—á–Ω–æ—Å—Ç</h4>
                    <p id="gps-accuracy">–ü—Ä–æ–≤–µ—Ä—è–≤–∞ —Å–µ...</p>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="app.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(function(registration) {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
        
        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('PWA install prompt available');
        });
        
        // Info Modal Functions
        function showInfoModal() {
            document.getElementById('info-modal').style.display = 'flex';
            updateGPSAccuracy();
        }
        
        function closeInfoModal() {
            document.getElementById('info-modal').style.display = 'none';
        }
        
        function updateGPSAccuracy() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const accuracy = position.coords.accuracy;
                        document.getElementById('gps-accuracy').textContent = 
                            `GPS —Ç–æ—á–Ω–æ—Å—Ç: ¬±${Math.round(accuracy)} –º–µ—Ç—Ä–∞`;
                    },
                    () => {
                        document.getElementById('gps-accuracy').textContent = 
                            'GPS –Ω–µ –µ –¥–æ—Å—Ç—ä–ø–µ–Ω';
                    }
                );
            } else {
                document.getElementById('gps-accuracy').textContent = 
                    'GPS –Ω–µ —Å–µ –ø–æ–¥–¥—ä—Ä–∂–∞';
            }
        }
    </script>
</body>
</html>